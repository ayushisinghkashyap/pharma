<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Reset Password - Pharma AI</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@400;700&family=Montserrat:wght@300;400;600;700&display=swap');

    /* Base Styles */
    :root {
      --primary-glow: #00e6ff;
      --secondary-glow: #00ffff;
      --tertiary-glow: #00b8ff;
      --dark-bg: #0f2027;
      --light-text: #b9dce0;
      --input-bg: #003344;
      --input-focus-bg: #005577;
      --container-bg: rgba(0, 30, 50, 0.85);
      --error-color: #ff4d4d;
      --success-color: #00e676;
    }

    * {
      box-sizing: border-box;
      transition: all 0.3s ease;
    }

    body {
      margin: 0;
      height: 100vh;
      background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
      font-family: 'Montserrat', sans-serif;
      color: var(--light-text);
      display: flex;
      justify-content: center;
      align-items: center;
      overflow: hidden;
      position: relative;
    }

    /* Animated Background with DNA helix and molecules */
    .animated-bg {
      position: fixed;
      width: 100%;
      height: 100%;
      top: 0; left: 0;
      pointer-events: none;
      overflow: hidden;
      z-index: 0;
    }

    .dna-helix {
      position: absolute;
      width: 100%;
      height: 200%;
      background: repeating-linear-gradient(
        90deg, 
        transparent, 
        transparent 40px, 
        rgba(0, 230, 255, 0.05) 40px, 
        rgba(0, 230, 255, 0.05) 80px
      );
      animation: rotateHelix 120s linear infinite;
      transform-origin: center;
    }
    
    @keyframes rotateHelix {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .shape {
      position: absolute;
      opacity: 0.15;
      filter: drop-shadow(0 0 6px var(--primary-glow));
      animation-timing-function: ease-in-out;
      animation-iteration-count: infinite;
      user-select: none;
    }

    /* Advanced medical cross shape */
    .cross {
      width: 80px;
      height: 80px;
      background: var(--primary-glow);
      clip-path: polygon(
        40% 0%, 60% 0%, 60% 40%, 100% 40%, 100% 60%, 60% 60%, 60% 100%, 40% 100%, 40% 60%, 0% 60%, 0% 40%, 40% 40%
      );
      animation: floatUpDown 6s alternate infinite, 
                 pulseGlow 3s alternate infinite,
                 rotateCross 20s linear infinite;
      transform-origin: center;
    }

    /* Heartbeat line shape */
    .heartbeat {
      width: 120px;
      height: 40px;
      background: transparent;
      border-bottom: 4px solid var(--primary-glow);
      position: relative;
      animation: floatLeftRight 8s alternate infinite,
                 pulseGlow 3s alternate infinite,
                 scaleHeartbeat 4s alternate infinite;
      transform-origin: center;
    }
    .heartbeat::before {
      content: '';
      position: absolute;
      left: 10%;
      bottom: 0;
      width: 10px;
      height: 20px;
      border-left: 4px solid var(--primary-glow);
      border-bottom: 4px solid var(--primary-glow);
      transform: rotate(-45deg);
      animation: heartbeatPulse 1.5s infinite;
      transform-origin: center;
    }
    .heartbeat::after {
      content: '';
      position: absolute;
      left: 30%;
      bottom: 0;
      width: 10px;
      height: 30px;
      border-left: 4px solid var(--primary-glow);
      border-bottom: 4px solid var(--primary-glow);
      transform: rotate(45deg);
      animation: heartbeatPulse 1.5s infinite 0.75s;
      transform-origin: center;
    }

    /* Molecule shape */
    .molecule {
      width: 100px;
      height: 100px;
      position: relative;
      animation: floatDiagonal 12s alternate infinite,
                 pulseGlow 4s alternate infinite,
                 rotateMolecule 30s linear infinite;
    }
    .molecule::before {
      content: '';
      position: absolute;
      width: 20px;
      height: 20px;
      background: var(--primary-glow);
      border-radius: 50%;
      left: 40px;
      top: 40px;
    }
    .molecule .atom {
      position: absolute;
      width: 12px;
      height: 12px;
      background: var(--tertiary-glow);
      border-radius: 50%;
    }
    .molecule .atom:nth-child(1) { top: 10px; left: 44px; }
    .molecule .atom:nth-child(2) { top: 44px; left: 10px; }
    .molecule .atom:nth-child(3) { top: 44px; left: 78px; }
    .molecule .atom:nth-child(4) { top: 78px; left: 44px; }
    .molecule .bond {
      position: absolute;
      width: 40px;
      height: 2px;
      background: var(--primary-glow);
      transform-origin: center;
    }
    .molecule .bond:nth-child(5) {
      top: 49px;
      left: 20px;
      transform: rotate(0deg);
    }
    .molecule .bond:nth-child(6) {
      top: 30px;
      left: 49px;
      transform: rotate(90deg);
    }
    .molecule .bond:nth-child(7) {
      top: 49px;
      left: 60px;
      transform: rotate(0deg);
    }
    .molecule .bond:nth-child(8) {
      top: 70px;
      left: 49px;
      transform: rotate(90deg);
    }

    /* Animation keyframes */
    @keyframes floatUpDown {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-40px); }
    }
    @keyframes floatLeftRight {
      0%, 100% { transform: translateX(0); }
      50% { transform: translateX(40px); }
    }
    @keyframes floatDiagonal {
      0%, 100% { transform: translate(0, 0); }
      25% { transform: translate(30px, -30px); }
      50% { transform: translate(0, -60px); }
      75% { transform: translate(-30px, -30px); }
    }
    @keyframes pulseGlow {
      0%, 100% { filter: drop-shadow(0 0 6px var(--primary-glow)); }
      50% { filter: drop-shadow(0 0 20px var(--secondary-glow)); }
    }
    @keyframes heartbeatPulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.3; }
    }
    @keyframes rotateCross {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes rotateMolecule {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
    @keyframes scaleHeartbeat {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    /* Position shapes strategically */
    .cross1 { top: 10%; left: 10%; animation-delay: 0s, 1s, 0s; }
    .cross2 { top: 70%; left: 25%; animation-delay: 2s, 3s, 1s; }
    .cross3 { top: 40%; left: 85%; animation-delay: 4s, 5s, 2s; }
    .heartbeat1 { top: 20%; left: 60%; animation-delay: 1s, 0.5s, 0s; }
    .heartbeat2 { top: 60%; left: 80%; animation-delay: 3s, 1.5s, 1s; }
    .molecule1 { top: 15%; left: 30%; animation-delay: 0s, 2s, 0s; }
    .molecule2 { top: 70%; left: 60%; animation-delay: 3s, 4s, 2s; }

    /* Advanced Container Styles */
    .container {
      background: var(--container-bg);
      padding: 2.5rem 3rem;
      border-radius: 20px;
      box-shadow:
        0 0 15px var(--primary-glow),
        0 0 50px var(--primary-glow);
      width: 400px;
      backdrop-filter: blur(15px);
      position: relative;
      z-index: 10;
      text-align: center;
      color: #b2ebf2;
      user-select: none;
      overflow: hidden;
    }

    .container::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(
        circle at center,
        rgba(0, 230, 255, 0.1),
        transparent 70%
      );
      animation: rotateGlow 20s linear infinite;
      z-index: -1;
    }

    .logo {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary-glow);
      text-transform: uppercase;
      letter-spacing: 2px;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo-icon {
      margin-right: 10px;
      font-size: 1.8rem;
    }

    h1 {
      font-family: 'Roboto Slab', serif;
      font-weight: 700;
      font-size: 2.2rem;
      margin-bottom: 1.5rem;
      color: var(--primary-glow);
      text-shadow: 0 0 10px var(--primary-glow);
      letter-spacing: 1.5px;
    }

    .form-group {
      margin-bottom: 1.4rem;
      position: relative;
      text-align: left;
    }

    label {
      display: block;
      margin-bottom: 0.4rem;
      font-weight: 600;
      color: #80deea;
      text-align: left;
      user-select: text;
      transition: all 0.3s ease;
      position: absolute;
      top: 0;
      left: 0.8rem;
      background: var(--input-bg);
      padding: 0 0.5rem;
      font-size: 0.8rem;
      transform: translateY(-50%);
      z-index: 1;
    }

    .form-control {
      width: 100%;
      padding: 0.8rem 1rem;
      border: 2px solid rgba(0, 230, 255, 0.3);
      border-radius: 12px;
      font-size: 1rem;
      outline: none;
      background: var(--input-bg);
      color: #b2ebf2;
      box-shadow: inset 0 0 8px var(--primary-glow);
      transition: all 0.4s ease;
      user-select: text;
      position: relative;
    }
    
    .form-control:focus {
      box-shadow:
        0 0 12px var(--secondary-glow),
        inset 0 0 12px var(--secondary-glow);
      background: var(--input-focus-bg);
      color: #e0ffff;
      transform: scale(1.02);
      border-color: var(--primary-glow);
    }
    
    .form-control:hover {
      box-shadow:
        0 0 10px var(--tertiary-glow),
        inset 0 0 10px var(--tertiary-glow);
      transform: scale(1.01);
    }

    .password-toggle {
      position: absolute;
      right: 1rem;
      top: 50%;
      transform: translateY(-50%);
      background: none;
      border: none;
      color: var(--primary-glow);
      cursor: pointer;
      font-size: 1.2rem;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
      opacity: 0.7;
      transition: all 0.3s ease;
    }

    .password-toggle:hover {
      opacity: 1;
      transform: translateY(-50%) scale(1.1);
    }

    .password-strength {
      height: 5px;
      width: 100%;
      background: #003344;
      border-radius: 5px;
      margin-top: 8px;
      overflow: hidden;
      position: relative;
    }

    .password-strength-meter {
      height: 100%;
      width: 0%;
      border-radius: 5px;
      transition: width 0.5s ease, background 0.5s ease;
    }

    .password-tips {
      font-size: 0.8rem;
      color: #80deea;
      margin-top: 0.5rem;
      display: none;
      text-align: left;
      padding-left: 0.5rem;
    }

    .password-tips.show {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .password-criteria {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .criteria {
      font-size: 0.75rem;
      padding: 0.2rem 0.5rem;
      border-radius: 50px;
      background: rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      transition: all 0.3s ease;
    }

    .criteria-icon {
      margin-right: 3px;
      font-size: 0.8rem;
    }

    .criteria.met {
      background: rgba(0, 230, 133, 0.2);
      color: var(--success-color);
    }

    button {
      width: 100%;
      padding: 1rem 0;
      background: linear-gradient(90deg, #00cfff, #00e6ff);
      border: none;
      border-radius: 40px;
      color: #002f3f;
      font-weight: 700;
      font-size: 1.3rem;
      cursor: pointer;
      box-shadow:
        0 0 15px var(--primary-glow),
        0 0 40px var(--primary-glow);
      transition: all 0.4s ease;
      user-select: none;
      position: relative;
      overflow: hidden;
      margin-top: 1rem;
    }
    
    button::before {
      content: '';
      position: absolute;
      top: 50%;
      left: -100%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle at center, rgba(0, 230, 255, 0.4), transparent 70%);
      transform: translateY(-50%);
      transition: transform 0.5s ease;
      border-radius: 40px;
      z-index: 0;
    }
    
    button:hover::before {
      transform: translateY(-50%) translateX(75%);
    }
    
    button:hover {
      background: linear-gradient(90deg, var(--secondary-glow), var(--tertiary-glow));
      box-shadow:
        0 0 30px var(--secondary-glow),
        0 0 60px var(--secondary-glow);
      color: #001a26;
      transform: scale(1.05);
    }

    button:active {
      transform: scale(0.98);
    }

    button span {
      position: relative;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    button .button-icon {
      margin-right: 10px;
      font-size: 1.4rem;
    }

    .button-loader {
      display: none;
      width: 20px;
      height: 20px;
      border: 3px solid transparent;
      border-top-color: #002f3f;
      border-radius: 50%;
      margin-right: 10px;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    button.loading .button-loader {
      display: inline-block;
    }

    button.loading .button-icon {
      display: none;
    }

    .message {
      margin-top: 1rem;
      padding: 0.8rem;
      border-radius: 10px;
      font-weight: 600;
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 1.2em;
      opacity: 0;
      transform: translateY(-10px);
      transition: all 0.5s ease;
    }

    .message.show {
      opacity: 1;
      transform: translateY(0);
    }

    .message.error {
      background: rgba(255, 77, 77, 0.2);
      color: var(--error-color);
    }

    .message.success {
      background: rgba(0, 230, 118, 0.2);
      color: var(--success-color);
    }

    .message-icon {
      margin-right: 8px;
      font-size: 1.2rem;
    }

    .links {
      margin-top: 2rem;
      display: flex;
      justify-content: center;
      font-size: 0.9rem;
    }

    .links a {
      color: #80deea;
      text-decoration: none;
      padding: 0.5rem 1rem;
      border-radius: 20px;
      transition: all 0.3s ease;
    }

    .links a:hover {
      color: var(--primary-glow);
      background: rgba(0, 230, 255, 0.1);
      text-shadow: 0 0 8px var(--primary-glow);
    }

    .links a:not(:last-child) {
      margin-right: 1rem;
    }

    /* Animated progress circles */
    .progress-circles {
      display: flex;
      justify-content: center;
      margin: 1.5rem 0;
    }

    .progress-circle {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: rgba(0, 230, 255, 0.2);
      margin: 0 5px;
      position: relative;
      cursor: pointer;
    }

    .progress-circle::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 100%;
      border-radius: 50%;
      background: var(--primary-glow);
      transform: scale(0);
      transition: transform 0.3s ease;
    }

    .progress-circle.active::after {
      transform: scale(1);
    }

    /* Responsive */
    @media (max-width: 500px) {
      .container {
        width: 90%;
        padding: 2rem 1.5rem;
      }
      
      h1 {
        font-size: 2rem;
      }
      
      .password-criteria {
        gap: 0.3rem;
      }
      
      .criteria {
        font-size: 0.65rem;
        padding: 0.15rem 0.4rem;
      }
    }
  </style>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/js/all.min.js"></script>
</head>
<body>
  <div class="animated-bg" aria-hidden="true">
    <div class="dna-helix"></div>
    <div class="shape cross cross1"></div>
    <div class="shape cross cross2"></div>
    <div class="shape cross cross3"></div>
    <div class="shape heartbeat heartbeat1"></div>
    <div class="shape heartbeat heartbeat2"></div>
    <div class="shape molecule molecule1">
      <div class="atom"></div>
      <div class="atom"></div>
      <div class="atom"></div>
      <div class="atom"></div>
      <div class="bond"></div>
      <div class="bond"></div>
      <div class="bond"></div>
      <div class="bond"></div>
    </div>
    <div class="shape molecule molecule2">
      <div class="atom"></div>
      <div class="atom"></div>
      <div class="atom"></div>
      <div class="atom"></div>
      <div class="bond"></div>
      <div class="bond"></div>
      <div class="bond"></div>
      <div class="bond"></div>
    </div>
  </div>

  <div class="container" role="main" aria-label="Reset Password Form">
    <div class="logo">
      <i class="fas fa-capsules logo-icon"></i>
      <span>PharmaAI</span>
    </div>
    <h1>Reset Password</h1>
    
    <div class="progress-circles">
      <div class="progress-circle active" data-step="1"></div>
      <div class="progress-circle" data-step="2"></div>
      <div class="progress-circle" data-step="3"></div>
    </div>
    
    <form id="resetForm" novalidate>
      <div class="form-group">
        <label for="oldPassword">Old Password</label>
        <input type="password" id="oldPassword" class="form-control" name="oldPassword" required autocomplete="current-password" aria-required="true" />
      </div>

      <div class="form-group">
        <label for="newPassword">New Password</label>
        <input type="password" id="newPassword" class="form-control" name="newPassword" required autocomplete="new-password" aria-required="true" />
        
        <div class="password-strength">
          <div class="password-strength-meter"></div>
        </div>
        <div class="password-tips">
          <div class="password-criteria">
            <span class="criteria" data-criteria="length">
              <i class="fas fa-circle criteria-icon"></i> 8+ characters
            </span>
            <span class="criteria" data-criteria="uppercase">
              <i class="fas fa-circle criteria-icon"></i> Uppercase
            </span>
            <span class="criteria" data-criteria="lowercase">
              <i class="fas fa-circle criteria-icon"></i> Lowercase
            </span>
            <span class="criteria" data-criteria="number">
              <i class="fas fa-circle criteria-icon"></i> Number
            </span>
            <span class="criteria" data-criteria="special">
              <i class="fas fa-circle criteria-icon"></i> Special char
            </span>
          </div>
        </div>
      </div>
      
      <div class="form-group">
        <label for="confirmPassword">Confirm Password</label>
        <input type="password" id="confirmPassword" class="form-control" name="confirmPassword" required autocomplete="new-password" aria-required="true" />
      </div>
      
      <button type="submit" aria-label="Change Password Button">
        <span>
          <div class="button-loader"></div>
          <i class="fas fa-lock-open button-icon"></i>
          Change Password
        </span>
      </button>
    </form>
    
    <div id="message" class="message" role="alert" aria-live="assertive"></div>
    
    <div class="links">
      <a href="login.html"><i class="fas fa-sign-in-alt"></i> Back to Login</a>
      <a href="#" id="helpLink"><i class="fas fa-question-circle"></i> Help</a>
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('resetForm');
      const oldPasswordInput = document.getElementById('oldPassword');
      const passwordInput = document.getElementById('newPassword');
      const confirmPasswordInput = document.getElementById('confirmPassword');
      const messageElement = document.getElementById('message');
      const submitButton = form.querySelector('button[type="submit"]');
      const passwordToggle = document.querySelector('.password-toggle');
      const passwordStrengthMeter = document.querySelector('.password-strength-meter');
      const passwordTips = document.querySelector('.password-tips');
      const criteriaElements = document.querySelectorAll('.criteria');
      
      // Function to show message
      function showMessage(text, type) {
        messageElement.textContent = '';
        messageElement.classList.remove('error', 'success', 'show');
        
        const icon = document.createElement('i');
        icon.className = `fas ${type === 'error' ? 'fa-circle-exclamation' : 'fa-circle-check'} message-icon`;
        
        messageElement.appendChild(icon);
        messageElement.appendChild(document.createTextNode(text));
        messageElement.classList.add(type, 'show');
        
        // Auto-hide success messages after 5 seconds
        if (type === 'success') {
          setTimeout(() => {
            messageElement.classList.remove('show');
          }, 5000);
        }
      }
      
      // Password visibility toggle
      passwordToggle.addEventListener('click', function() {
        const iconElement = this.querySelector('i');
        const inputElement = passwordInput;
        
        if (inputElement.type === 'password') {
          inputElement.type = 'text';
          iconElement.className = 'fas fa-eye-slash';
        } else {
          inputElement.type = 'password';
          iconElement.className = 'fas fa-eye';
        }
      });
      
      // Password strength checker
      passwordInput.addEventListener('input', function() {
        const password = this.value;
        let strength = 0;
        let strengthColor = '';
        
        // Show password tips when typing
        if (password.length > 0) {
          passwordTips.classList.add('show');
        } else {
          passwordTips.classList.remove('show');
        }
        
        // Check criteria
        const criteria = {
          length: password.length >= 8,
          uppercase: /[A-Z]/.test(password),
          lowercase: /[a-z]/.test(password),
          number: /[0-9]/.test(password),
          special: /[^A-Za-z0-9]/.test(password)
        };
        
        // Update criteria elements
        criteriaElements.forEach(el => {
          const criteriaName = el.dataset.criteria;
          if (criteria[criteriaName]) {
            el.classList.add('met');
            el.querySelector('.criteria-icon').className = 'fas fa-check-circle criteria-icon';
          } else {
            el.classList.remove('met');
            el.querySelector('.criteria-icon').className = 'fas fa-circle criteria-icon';
          }
        });
        
        // Calculate strength
        Object.values(criteria).forEach(met => {
          if (met) strength += 1;
        });
        
        // Update strength meter
        const strengthPercentage = (strength / 5) * 100;
        passwordStrengthMeter.style.width = `${strengthPercentage}%`;
        
        // Change color based on strength
        if (strength <= 1) {
          strengthColor = '#ff4d4d'; // Very weak (red)
        } else if (strength === 2) {
          strengthColor = '#ffa64d'; // Weak (orange)
        } else if (strength === 3) {
          strengthColor = '#ffff4d'; // Medium (yellow)
        } else if (strength === 4) {
          strengthColor = '#4dff4d'; // Strong (light green)
        } else {
          strengthColor = '#00e676'; // Very strong (green)
        }
        
        passwordStrengthMeter.style.background = strengthColor;
        
        // Check if passwords match
        validatePasswordMatch();
      });
      
      // Validate password match
      confirmPasswordInput.addEventListener('input', validatePasswordMatch);
      
      function validatePasswordMatch() {
        if (confirmPasswordInput.value && passwordInput.value !== confirmPasswordInput.value) {
          confirmPasswordInput.style.borderColor = 'var(--error-color)';
        } else {
          confirmPasswordInput.style.borderColor = '';
        }
      }
      
      // Parallax effect for background shapes
      document.addEventListener('mousemove', (e) => {
        const shapes = document.querySelectorAll('.shape');
        const x = e.clientX / window.innerWidth;
        const y = e.clientY / window.innerHeight;
        shapes.forEach((shape, index) => {
          const speed = (index + 1) * 5;
          const xOffset = (x - 0.5) * speed;
          const yOffset = (y - 0.5) * speed;
          shape.style.transform = `translate(${xOffset}px, ${yOffset}px)`;
        });
      });

      // Form submission handler
      form.addEventListener('submit', async (e) => {
        e.preventDefault();

        // Clear previous messages
        messageElement.textContent = '';
        messageElement.classList.remove('error', 'success', 'show');

        const oldPassword = oldPasswordInput.value;
        const newPassword = passwordInput.value;
        const confirmPassword = confirmPasswordInput.value;

        // Basic validation
        if (!oldPassword) {
          showMessage('Old password is required.', 'error');
          return;
        }
        if (!newPassword) {
          showMessage('New password is required.', 'error');
          return;
        }
        if (newPassword !== confirmPassword) {
          showMessage('Passwords do not match.', 'error');
          return;
        }

        // Disable submit button and show loading
        submitButton.disabled = true;
        submitButton.classList.add('loading');

        try {
          const token = localStorage.getItem('token');
          if (!token) {
            showMessage('User is not authenticated. Please login again.', 'error');
            submitButton.disabled = false;
            submitButton.classList.remove('loading');
            return;
          }

          const response = await fetch('/api/changePassword', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify({ oldPassword, newPassword })
          });

          const data = await response.json();

          if (response.ok) {
            showMessage(data.message || 'Password changed successfully.', 'success');
            form.reset();
            passwordStrengthMeter.style.width = '0%';
            passwordTips.classList.remove('show');
          } else {
            showMessage(data.message || 'Failed to change password.', 'error');
          }
        } catch (error) {
          showMessage('An error occurred. Please try again later.', 'error');
        } finally {
          submitButton.disabled = false;
          submitButton.classList.remove('loading');
        }
      });
    });
  </script>
</body>
</html>